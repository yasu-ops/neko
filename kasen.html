<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下線付きテキスト抽出ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        #editor-container {
            height: auto;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }        
        #editor {
            height: auto;
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>下線付きテキスト抽出ツール</h1>
    <div id="editor"></div>
    <button onclick="extractUnderlinedText()">下線付きテキストを抽出</button>
    <button onclick="copyTableForWord()" id="copyButton" style="display:none;">Wordに貼り付け用にコピー</button>
    <div id="result"></div>

    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'],
                    ['link', 'blockquote', 'code-block'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'size': ['small', false, 'large', 'huge'] }] 
                ]
            }
        });

        quill.on('text-change', function() {
            updateEditorHeight();
        });

        function updateEditorHeight() {
            var editorContainer = document.getElementById('editor-container');
            var quillEditor = document.querySelector('.ql-editor');
            editorContainer.style.height = 'auto';
            editorContainer.style.height = quillEditor.scrollHeight + 'px';
        }

        // キーボードショートカットの設定
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && (event.key === 'u'|| event.key === 'U')) {
                event.preventDefault();
                let range = quill.getSelection();
                if (range) {
                    quill.formatText(range.index, range.length, 'underline', true);
                }
            }
        });
        
        function extractUnderlinedText() {
            const delta = quill.getContents();
            const underlinedTexts = [];

            delta.ops.forEach(op => {
                if (op.attributes && op.attributes.underline) {
                    underlinedTexts.push(op.insert.trim());
                }
            });

            const resultDiv = document.getElementById('result');
            if (underlinedTexts.length > 0) {
                let tableHTML = '<table><tr><th width="5%">頁</th><th width="5%">行</th><th width="20%">調べたい語句</th><th width="70%">調べた結果</th></tr>';
                underlinedTexts.forEach(text => {
                    if (text !== '') {
                        tableHTML += `<tr><td></td><td></td><td>${text}</td><td></td></tr>`;
                    }
                });
                tableHTML += '</table>';
                resultDiv.innerHTML = tableHTML;
                document.getElementById('copyButton').style.display = 'inline-block';
            } else {
                resultDiv.innerHTML = '<p>下線付きのテキストが見つかりませんでした。</p>';
                document.getElementById('copyButton').style.display = 'none';
            }
        }

        function copyTableForWord() {
            const table = document.querySelector('table');
            if (!table) return;

            const range = document.createRange();
            range.selectNode(table);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);

            try {
                document.execCommand('copy');
                alert('表がクリップボードにコピーされました。Wordに貼り付けることができます。');
            } catch (err) {
                console.error('コピーに失敗しました:', err);
                alert('コピーに失敗しました。ブラウザの設定を確認してください。');
            }

            window.getSelection().removeAllRanges();
        }
        // 初期高さを設定
        updateEditorHeight();
    </script>
</body>
</html>


